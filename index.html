<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ACNH Switch 2 v3.0.0 Countdown</title>
  <style>
    :root { color-scheme: light; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      background:
        linear-gradient(180deg, #bfe9ff 0%, #fff2b8 45%, #c9f7c7 100%),
        url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22140%22%20height%3D%22140%22%3E%0A%20%20%3Cg%20opacity%3D%220.22%22%20fill%3D%22%2380cfa2%22%3E%0A%20%20%20%20%3Cpath%20d%3D%22M34%2032c18%202%2030%2012%2035%2030-18%200-33-6-42-18-4-5-6-8-7-12%204%200%209%200%2014%200z%22/%3E%0A%20%20%20%20%3Cpath%20d%3D%22M106%2076c-18%202-30%2012-35%2030%2018%200%2033-6%2042-18%204-5%206-8%207-12-4%200-9%200-14%200z%22/%3E%0A%20%20%20%20%3Cpath%20d%3D%22M28%20104c20-1%2034%207%2042%2024-20%201-36-4-46-15-4-5-6-7-7-9%203%200%206%200%2011%200z%22/%3E%0A%20%20%20%20%3Cpath%20d%3D%22M118%20120c-20-1-34%207-42%2024%2020%201%2036-4%2046-15%204-5%206-7%207-9-3%200-6%200-11%200z%22/%3E%0A%20%20%3C/g%3E%0A%3C/svg%3E");
      background-size: cover, 140px 140px;
      background-repeat: no-repeat, repeat;
    }
    .wrap{ width:min(980px, 92vw); padding: 54px 0 90px; }
    .card{
      width: min(720px, 100%);
      margin: 0 auto;
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      box-shadow: 0 12px 40px rgba(0,0,0,.12);
      padding: 28px 26px;
      border: 1px solid rgba(0,0,0,.06);
      text-align:center;
    }
    h1{
      margin: 0 0 6px;
      font-size: clamp(20px, 2.4vw, 30px);
      font-weight: 800;
      letter-spacing: .2px;
    }
    .sub{
      margin: 0 0 18px;
      opacity: .75;
      font-weight: 650;
      font-size: 14px;
    }
    .rows{
      margin: 14px auto 10px;
      display: grid;
      gap: 10px;
      width: min(560px, 100%);
      text-align:left;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap: 14px;
      font-size: 14px;
      line-height: 1.35;
      padding: 8px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(0,0,0,.05);
    }
    .k{ opacity:.70; font-weight: 700; }
    .v{ font-variant-numeric: tabular-nums; font-weight: 700; }
    .remaining{
      margin: 16px 0 0;
      font-size: clamp(22px, 3.2vw, 36px);
      font-weight: 900;
      letter-spacing: .3px;
    }
    .pill{
      display:inline-block;
      margin-top: 14px;
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.72);
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
      font-variant-numeric: tabular-nums;
    }
    .hint{
      margin-top: 18px;
      font-size: 12px;
      opacity: .72;
    }
    code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Animal Crossing: New Horizons — Nintendo Switch 2 Edition (v3.0.0)</h1>
      <div class="sub">Timezone detection + non-stalling time sync</div>

      <div class="rows">
        <div class="row"><div class="k">Your time zone:</div><div class="v" id="tz">…</div></div>
        <div class="row"><div class="k">Target (Your time):</div><div class="v" id="target">…</div></div>
        <div class="row"><div class="k">Now (Your time):</div><div class="v" id="now">…</div></div>
      </div>

      <div class="remaining">Remaining: <span id="remaining">…</span></div>
      <div class="pill" id="status">Syncing time…</div>

      <div class="hint">
        Default target is <code>Jan 14, 2026 8:00 PM ET</code> (<code>Jan 15 01:00 UTC</code>). Change <code>TARGET_UTC_MS</code> below if you need a different time.
      </div>
    </div>
  </div>

<script>
function getUserTimeZone() {
  return Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC";
}

// Returns: { nowMs: () => number, source: "server" | "device", skewMs: number }
async function createNowProvider({ timeoutMs = 2500 } = {}) {
  const wrapWithPerf = (baseMs, basePerf) => () => baseMs + (performance.now() - basePerf);

  const fallback = () => {
    const t = performance.now();
    return { nowMs: wrapWithPerf(Date.now(), t), source: "device", skewMs: 0 };
  };

  if (location.protocol === "file:") return fallback();

  const controller = new AbortController();
  const timer = setTimeout(() => controller.abort(), timeoutMs);

  try {
    const t0 = performance.now();
    const res = await fetch(location.href, { method: "HEAD", cache: "no-store", signal: controller.signal });
    const t1 = performance.now();

    const dateHeader = res.headers.get("date") || res.headers.get("Date");
    if (!dateHeader) throw new Error("No Date header");

    const serverMs = Date.parse(dateHeader);
    if (!Number.isFinite(serverMs)) throw new Error("Bad Date header");

    const rtt = t1 - t0;
    const estimatedNowAtT1 = serverMs + rtt / 2;

    const nowMs = wrapWithPerf(estimatedNowAtT1, t1);
    const skewMs = estimatedNowAtT1 - Date.now();

    return { nowMs, source: "server", skewMs };
  } catch (e) {
    return fallback();
  } finally {
    clearTimeout(timer);
  }
}

// Default: Jan 14, 2026 8:00 PM ET  =>  Jan 15, 2026 01:00:00 UTC
const TARGET_UTC_MS = Date.UTC(2026, 0, 15, 1, 0, 0);

const els = {
  tz: document.getElementById("tz"),
  target: document.getElementById("target"),
  now: document.getElementById("now"),
  remaining: document.getElementById("remaining"),
  status: document.getElementById("status"),
};

function fmtDate(ms, timeZone) {
  return new Intl.DateTimeFormat(undefined, {
    timeZone,
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
  }).format(new Date(ms));
}

function fmtRemaining(deltaMs) {
  const s = Math.max(0, Math.floor(deltaMs / 1000));
  const days = Math.floor(s / 86400);
  const hours = Math.floor((s % 86400) / 3600);
  const mins = Math.floor((s % 3600) / 60);
  const secs = s % 60;
  const pad = (n) => String(n).padStart(2, "0");
  return `${days}d ${pad(hours)}h ${pad(mins)}m ${pad(secs)}s`;
}

async function startCountdown() {
  const timeZone = getUserTimeZone();
  els.tz.textContent = timeZone;

  els.status.textContent = "Syncing time…";
  const { nowMs, source, skewMs } = await createNowProvider({ timeoutMs: 2500 });

  if (source === "server") {
    const skewSec = Math.round(skewMs / 1000);
    els.status.textContent = `Synced from server ✓ (skew ${skewSec}s)`;
  } else {
    els.status.textContent = "Using device time (sync unavailable)";
  }

  els.target.textContent = fmtDate(TARGET_UTC_MS, timeZone);

  const tick = () => {
    const now = nowMs();
    els.now.textContent = fmtDate(now, timeZone);

    const remaining = TARGET_UTC_MS - now;
    els.remaining.textContent = fmtRemaining(remaining);

    if (remaining <= 0) els.status.textContent = "Ready!";
  };

  tick();
  setInterval(tick, 250);
}

document.addEventListener("DOMContentLoaded", startCountdown);
</script>
</body>
</html>
